nextflow_process {

    name "Test Process RUN_ASCAT_EXOMES"
    script "modules/ascat.nf"
    process "RUN_ASCAT_EXOMES"

    test("Should run without failures") {
        when {
        params {
        outdir = "/home/ubuntu/projects/dermatlas_copy_number_nf/results"
        reference_genome = "/lustre/scratch124/jb63/ascat/GRCh38_full_analysis_set_plus_decoy_hla.fa"
        bait_set = "/lustre/scratch124/jb63/ascat/GRCh38_WES5_canonical_pad100.merged.bed"
        resource_files = "/lustre/scratch124/jb63/ascat/resources/1000G_loci_hg38_chr"
        gc_file = "/lustre/scratch124/jb63/ascat/resources/1000G_GC_exome_chr.txt"
        rt_file = "/lustre/scratch124/jb63/ascat/resources/1000G_RT_exome_chr.txt"
        gistic_refgene_file = "/lustre/scratch124/jb63/ascat/hg38.UCSC.add_miR.160920.refgene.mat"
        difficult_regions_file = "/lustre/scratch124/jb63/ascat/resources/GRCh38_alldifficultregions.bed"
        }
        process {
        """
        input[0] = tuple(
            [pair_id: "PD54403a_PD54403b", normal: "PD54403a", tumor: "PD54403b", Sex: "M", Phenotype: "N", sexchr: "XY"], 
            file("/lustre/scratch124/jb63/ascat/bams/PD54403a/PD54403a.sample.dupmarked.bam"), 
            file("/lustre/scratch124/jb63/ascat/bams/PD54403a/PD54403a.sample.dupmarked.bam.bai"), 
            file("/lustre/scratch124/jb63/ascat/bams/PD54403b/PD54403b.sample.dupmarked.bam"),
            file("/lustre/scratch124/jb63/ascat/bams/PD54403b/PD54403b.sample.dupmarked.bam.bai"))
        input[1] = "${params.outdir}"
        input[2] = file("${params.reference_genome}")
        input[3] = file("${params.bait_set}") 
        input[4] = file("${params.resource_files}")
        input[5] = file("${params.gc_file}")
        input[6] = file("${params.rt_file}")
        """
        }
        }

        then {
            assert process.success
            assert snapshot(process.out).match()
        }

        
}
}

